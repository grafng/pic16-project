
void  interrupt()   // функция-обработчик прерываний от TMR0 и INT
{

    if ( INTF == 1 )             // если запрос прерывания по INT
    {
        flag = 1;
        //Lcd_Cmd(_LCD_CLEAR);          // очистить ЖКД
        //Lcd_Out(1, 5, “ERROR”);           // вывод на дисплей
        // сообщения об аварии
        Sound_Play(500,  10000);          // вывод звукового сигнала
        // частоты 500 Гц длительностью 10 секунд
        while (1)              // вывод мигающего светового сигнала  и
        {                                                     // зацикливание программы
            PORTB.B1 = 1;                       // включить светодиод
            Delay_ms(500);                    // задержка на 500 мс
            PORTB.B1 = 0;                       // выключить светодиод
            Delay_ms(500);
        }
    }
    // запрос прерывания от таймера TMR0
    counter++;
    if ( counter == 100 )          // если прошло время опроса 1,8 с
    {
        flag_T = 1;               // установить флаг окончания отсчета
                                  // времени ТОПР = 1,8 с
        counter = 0;
    }
    TMR0 = 1;                    // перезагрузить таймер
    T0IF_bit = 0;                // сбросить флаг запроса прерывания T0IF
}



void main()
{
    
    init();
again:
    digit();
    analog();
opros:
    key = 0;
    key = Keypad_Key_Click();
    
    if ( key != 0 )
        display();
    
    if ( flag_T == 0 )
    {
        
        if (flag == 1)
        {
            Lcd_Cmd(_LCD_CLEAR);          // очистить ЖКД
            Lcd_Out(1, 5, "ERROR");           // вывод на дисплей
            flag = 0;
        }
        
        goto opros;
    }
    else
    {
        flag_T = 0;
        counter = 0;
        TMR0 = 12;
        goto again;
    }
    
}